---
title: "Presentation"
author: "Group 313:2"
date: "10/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
library(tidyverse)
library(lubridate)
library(stringr)
library(splitstackshape)
```

```{r viridis-defaults, include=FALSE, eval=TRUE}
## reset color defaults
## Source https://data-se.netlify.com/2018/12/12/changing-the-default-color-scheme-in-ggplot2/
#library(viridis)
library(scales)

#### continuous variables color and fill
options(ggplot2.continuous.colour = "viridis")
options(ggplot2.continuous.fill = "viridis")

#### use viridis for discrete scales
scale_colour_discrete <- scale_colour_viridis_d
scale_fill_discrete <- scale_colour_viridis_d

## reset default theme
##theme_set(theme_minimal())
```

```{r read-data, warning=FALSE, include=FALSE}
## Read and transform the data
ca_data = read_csv("CAvideos.csv")
fr_data = read_csv("FRvideos.csv")
gb_data = read_csv("GBvideos.csv")
in_data = read_csv("INvideos.csv")
jp_data = read_csv("JPvideos.csv")
mx_data = read_csv("MXvideos.csv")
ru_data = read_csv("RUvideos.csv")
us_data = read_csv("USvideos.csv")
              
```


## Introduction

YouTube uses a combination of factors including measuring user interactions (number of views, shares, comments, and likes). Our goal is mainly to use these metrics to see if there are patterns in what videos trend in different countries, and see how these different metrics vary over trending videos.

## Background
We found our data set on Kaggle.

We have data for 8 countries ( USA, Great Britain, Canada, France, Russia, Mexico, Japan, and India) about top trending videos over 205 days in CSV and we have categories id referenced in JSON. There are 16 columns:

- video_id: contains a unique id of the video (string)
- trending_date: the date when this video was trending. (date)
- title: title of that video (string)
- channel_title: the channel name from where it was published (string)
- category_id: id of category reference from JSON (number)
- publish_time: time video was published (date)
- tags: tags for the video (string)
- views: # of views on that video (number)
- likes: # of likes on that video (number)
- dislikes: # of dislikes on that video (number)
- comment_count: #of comments on that video (number)
- thumbnail_link: thumbnail link of that video (string)
- comments_disabled: are comments disabled on that video (bool)
- ratings_disabled: are ratings disabled on that video (bool)
- video_error_or_removed: is videos removed or there is an error (bool)
- description: description of that videos (string) 

## Analysis

### Likes And Dislikes

### 1

> Which categories have the most likes?

- Filter the data set to only include category, view, likes, dislikes, and comments (if any).
-Determine which categories have the most likes by summing up the number of likes between each category and arranging them by number of likes 

```{r problem-1}
most_likes = function(data){
  df = data %>%
  select(category_title, views, likes, dislikes, comment_count) %>%
  drop_na() %>%
  dplyr::group_by(category_title) %>%
  dplyr::summarize(likes = sum(likes)) %>%
  arrange(desc(likes)) %>%
  top_n(n=5) %>%
  print()
}

##Canada
most_likes(ca_data)
##US
most_likes(us_data)
##France
most_likes(fr_data)
## Mexico
most_likes(mx_data)
##Great Britain
most_likes(gb_data)
##India
most_likes(in_data)
## Japan
most_likes(jp_data)
## Russia
most_likes(ru_data)


## All combined
all_countries = bind_rows(fr_data, ca_data, us_data, mx_data, jp_data, ru_data, in_data, gb_data)
print("All Countries Combined")
all_countries %>%
  select(channel_title, category_title, views, likes, dislikes, comment_count) %>%
  drop_na() %>%
  dplyr::group_by(category_title) %>%
  dplyr::summarize(likes = sum(likes)) %>%
  arrange(desc(likes)) %>%
  top_n(n=5)%>%
  print()
```

In every country besides Great Britain and India, Music has the most likes out of all of the categories. It appears that there must be some missing data for Great Britain's music category, because it doesn't even fall into the top 10 categories while in every other country music and entertainment are at least top 3. This isn't surprising that these categories have the most likes because they are most often the less controversial videos with the least dislikes. Overall, music has the most likes by far, followed by Entertainment. The rest of the categories have much smaller numbers of likes. 

### 2

> Which categories have the most comments?

-Repeat number 1 with comments

```{r problem-2}
most_comments = function(data){
  df = data %>%
  select(channel_title, category_title, views, likes, dislikes, comment_count) %>%
  drop_na() %>%
  dplyr::group_by(category_title) %>%
  dplyr::summarize(comment_count = sum(comment_count)) %>%
  arrange(desc(comment_count)) %>%
  top_n(n=5) %>%
  print()
}

##Canada
most_comments(ca_data)
##US
most_comments(us_data)
##France
most_comments(fr_data)
## Mexico
most_comments(mx_data)
##Great Britain
most_comments(gb_data)
##India
most_comments(in_data)
## Japan
most_comments(jp_data)
## Russia
most_comments(ru_data)

# All countries combined
print("All Countries Combined")
all_countries %>%
  select(channel_title, category_title, views, likes, dislikes, comment_count) %>%
  drop_na() %>%
  dplyr::group_by(category_title) %>%
  dplyr::summarize(comment_count = sum(comment_count)) %>%
  arrange(desc(comment_count)) %>%
  top_n(n=5)%>%
  print()
```

Similar the the earlier question, Music and Entertainment have a consistent presence in the top 3 categories. People & Blogs is also a common category in the top 3. This is most likely due to the more interactive relationship between the youtubers and their audience in this category.

### 3

> Are there any trending videos with more dislikes than likes? If so, how many? What categories are most common in this case?

```{r problem-3}
more_dislikes = function(data){
  df = data %>%
  select(channel_title, category_title, views, likes, dislikes, comment_count) %>%
  drop_na() %>%
  dplyr::filter(dislikes>likes) %>%
  dplyr::group_by(category_title) %>%
  dplyr::summarize(n=n()) %>%
  arrange(desc(n)) %>%
    top_n(n=5) %>%
  print()

ggplot(df, aes(x=category_title,y=n)) +
  geom_col() +
  ggtitle("Trending Videos With More Dislikes Than Likes(Canada)") +
  xlab("Category Title") +
  ylab("Videos")
}

##Canada
more_dislikes(ca_data)
##US
more_dislikes(us_data)
##France
more_dislikes(fr_data)
## Mexico
more_dislikes(mx_data)
##Great Britain
more_dislikes(gb_data)
##India
more_dislikes(in_data)
## Japan
more_dislikes(jp_data)
## Russia
more_dislikes(ru_data)

```

This chunk of code shows us the categories with the most tending videos that have more dislikes than likes. News & Politics seems to be the category most often in the top 3. Entertainment is also included very often. This also is reasonable because News & Politics is one of the most controversial topics.

### Clickbait

We generally defined clickbait as any video with a title meeting any of the following criteria: it contains no lowercase letters, it contains 8 or more characters in a row that are either whitespace, an exclamation point, or a capital letter, or it contains a "?!" or "!?". There are a few exceptions to these rules, but those are not too common.

```{r data, include=FALSE}
read_select = function(x){
  df = read_csv(x) %>%
    select(-c(video_id, thumbnail_link, ratings_disabled, video_error_or_removed)) %>%
    mutate(trending_date = ydm(trending_date),
           publish_time = ymd_hms(publish_time)) %>%
    drop_na()
  
  return(df)
}

US = read_select("USvideos.csv")
CA = read_select("CAvideos.csv")
# DE = read_select("DEvideos.csv")
FR = read_select("FRvideos.csv")
GB = read_select("GBvideos.csv")
IN = read_select("INvideos.csv")
JP = read_select("JPvideos.csv")
# KR = read_select("KRvideos.csv")
MX = read_select("MXvideos.csv")
RU = read_select("RUvideos.csv")

alladem = bind_rows(US, CA, FR, GB, IN, JP, MX, RU)
```

```{r clickbait_function}
# things that could get caught by clickbait unfairly
deceptive = "BREAKING|CONAN|SPOILERS|IFC Films|RIVERDALE|PRESHOW|WIRED"

clickbait_parse = function(df){
  df = df %>%
    mutate(clickbait = case_when(
      str_detect(title, deceptive) ~ FALSE,
      str_detect(title, "^\\d+$") ~ FALSE,
      str_detect(title, "^[^a-z]+$") ~ TRUE,
      str_detect(title, "[A-Z\\s!]{8,}") ~ TRUE,
      str_detect(title, "\\? ?!") ~ TRUE,
      str_detect(title, "! ?\\?") ~ TRUE,
      TRUE ~ FALSE
    ))
  return(df)
}

set.seed(31437)
x = sample_n(US, 250) %>%
  select(title) 

x = clickbait_parse(x)

# may have to figure out other languages later
US = clickbait_parse(US)
FR = clickbait_parse(FR)
GB = clickbait_parse(GB)
CA = clickbait_parse(CA)
MX = clickbait_parse(MX)
```

### 4

> How prevalent is clickbait? How do the average number of views vary?

```{r clickbait_views}
clickbait_sum = function(data){
  df = data %>%
  dplyr::group_by(clickbait) %>%
  dplyr::summarize(n = n(),
            total_views = sum(views),
            average_views = mean(views)) %>%
  mutate(percent = n / sum(n))
  
  return(df)
}

bind_clickbait_sums = function(){
  US_cbsum = clickbait_sum(US) %>%
   mutate(country = "USA")
  
  FR_cbsum = clickbait_sum(FR) %>%
    mutate(country = "France")
  
  GB_cbsum = clickbait_sum(GB) %>%
    mutate(country = "Great Britain")
  
  MX_cbsum = clickbait_sum(MX) %>%
    mutate(country = "Mexico")
  
  CA_cbsum = clickbait_sum(CA) %>%
    mutate(country = "Canada")
  
  clickbait_sums = bind_rows(US_cbsum, FR_cbsum, GB_cbsum, MX_cbsum, CA_cbsum)
  
  return(clickbait_sums)
}

clickbait_sums = bind_clickbait_sums() %>%
  select(country, everything())
clickbait_sums
```

Clickbait seems to be the more prevalent in France and Mexico (about 40% of trending videos are clickbait) and less prevalent in the US and Great Britain (about 20% of trending videos are clickbait).

### 5

> How well do people receive clickbait? 

#### Hypothesis Tests for difference in likes and dislikes per view (separate)

$$
H_0: p_C = p_N \\
H_A: p_C \neq p_N
$$

```{r LV_DV_test_functions}
LV_test = function(data, type = "clickbait"){
  df = clickbait_parse(data)
  
  cb_LV = df %>%
    dplyr::group_by(clickbait) %>%
    dplyr::summarize(n = n(),
              p_LV = sum(likes) / sum(views))
  
  comm_LV = df %>%
    dplyr::group_by(comments_disabled) %>%
    dplyr::summarize(n = n(),
              p_LV = sum(likes) / sum(views))
  
  if(type == "comments") {
    use = comm_LV 
  } else{
    use = cb_LV
  }
  
  # values for clickbait vids (or comments disabled vids)
  p1 = use$p_LV[2]
  n1 = use$n[2]
  # values for non-clickbait vids (or comments enabled vids)
  p2 = use$p_LV[1]
  n2 = use$n[1]
  # combinationy
  p_pool = ((p1*n1) + (p2*n2)) / (n1 + n2)
  se_diff = sqrt( p_pool*(1-p_pool) * (1/n1 + 1/n2) )

  z_LV = (p1 - p2) / se_diff
  p_LV = 1 - pnorm(abs(z_LV))
  
  if(type == "comments"){
    result = tibble(
      enabled_LV_greater = z_LV < 0,
      z_score = abs(z_LV),
      p_value = p_LV
    )
  } else{
    result = tibble(
      cb_LV_greater = z_LV > 0,
      z_score = abs(z_LV),
      p_value = p_LV
    )
  }
  
  return(result)
}

DV_test = function(data, type = "clickbait"){
  df = clickbait_parse(data)
  
  cb_DV = df %>%
    dplyr::group_by(clickbait) %>%
    dplyr::summarize(n = n(),
              p_DV = sum(dislikes) / sum(views))
  
  comm_DV = df %>%
    dplyr::group_by(comments_disabled) %>%
    dplyr::summarize(n = n(),
              p_DV = sum(dislikes) / sum(views))
  
  if(type == "comments") {
    use = comm_DV 
  } else{
    use = cb_DV
  }
  
  # values for clickbait vids (or comments disabled vids)
  p1 = use$p_DV[2]
  n1 = use$n[2]
  # values for non-clickbait vids (or comments enabled vids)
  p2 = use$p_DV[1]
  n2 = use$n[1]
  # combinationy
  p_pool = ((p1*n1) + (p2*n2)) / (n1 + n2)
  se_diff = sqrt( p_pool*(1-p_pool) * (1/n1 + 1/n2) )
  
  z_DV = (p1 - p2) / se_diff 
  p_DV = 1 - pnorm(abs(z_DV))
  
  if(type == "comments"){
    result = tibble(
      enabled_DV_greater = z_DV < 0,
      z_score = abs(z_DV),
      p_value = p_DV
    )
  } else{
    result = tibble(
      cb_DV_greater = z_DV > 0,
      z_score = abs(z_DV),
      p_value = p_DV
    )
  }
  
  return(result)
}


bind_LV_tests = function(){
  US_LV = LV_test(US) %>%
    mutate(country = "USA")
  FR_LV = LV_test(FR) %>%
    mutate(country = "France")
  GB_LV = LV_test(GB) %>%
    mutate(country = "Great Britain")
  MX_LV = LV_test(MX) %>%
    mutate(country = "Mexico")
  CA_LV = LV_test(CA) %>%
    mutate(country = "Canada")
  
  LV_tests = bind_rows(US_LV, FR_LV, GB_LV, MX_LV, CA_LV)

  return(LV_tests)
}
LV_tests = bind_LV_tests()

bind_DV_tests = function(){
  US_DV = DV_test(US) %>%
    mutate(country = "USA")
  FR_DV = DV_test(FR) %>%
    mutate(country = "France")
  GB_DV = DV_test(GB) %>%
    mutate(country = "Great Britain")
  MX_DV = DV_test(MX) %>%
    mutate(country = "Mexico")
  CA_DV = DV_test(CA) %>%
    mutate(country = "Canada")
  
  DV_tests = bind_rows(US_DV, FR_DV, GB_DV, MX_DV, CA_DV)
  
  return(DV_tests)
}
DV_tests = bind_DV_tests()

print("Likes:")
LV_tests
print("Dislikes:")
DV_tests
```

For the tests for a difference in the proportion of likes/view in clickbait vs. 
non-clickbait videos in these 5 countries, our p-values are approximately 0, which are 
highly statistically significant. We therefore have very convincing evidence that 
the proportion of likes/view is higher for clickbait videos than for non-clickbait
videos in those 5 countries.

For the tests for a difference in the proportion of dislikes/view in clickbait vs. 
non-clickbait videos in these 5 countries, our p-values are 0.475, 0.452, 0.407, and 0.450,
non of which is statistically significant. We therefore do not have convincing evidence of 
a difference in the proportion of dislikes/view for clickbait videos vs. non-clickbait videos in any of those 5 countries.


### 6

> Which categories are clickbait the most frequently in each country?

```{r clickbait_categories}
clickbait_cats = function(data){
  df = clickbait_parse(data) %>%
    mutate(category_id = as.character(category_id)) %>%
    dplyr::group_by(category_title) %>%
    dplyr::summarize(n = n(),
              n_clickbait = sum(clickbait),
              p_clickbait = n_clickbait / n)
}

bind_clickbait_cats = function(){
  US_cats = clickbait_cats(US) %>%
    mutate(country = "US")
  FR_cats = clickbait_cats(FR) %>%
    mutate(country = "FR")
  GB_cats = clickbait_cats(GB) %>%
    mutate(country = "GB")
  MX_cats = clickbait_cats(MX) %>%
    mutate(country = "MX")
  CA_cats = clickbait_cats(CA) %>%
    mutate(country = "CA")
  
  clickbait_cats = bind_rows(US_cats, FR_cats, GB_cats, MX_cats, CA_cats)
  
  return(clickbait_cats)
}

clickbait_cats = bind_clickbait_cats() 

# overall
clickbait_cats %>%
  dplyr::group_by(category_title) %>%
  dplyr::summarize(n = sum(n),
            n_clickbait = sum(n_clickbait),
            p_clickbait = n_clickbait / n) %>%
  ggplot(aes(x = category_title, y = 100*p_clickbait)) +
  geom_col(color = "black", fill = "green") +
  xlab("Category") +
  ylab("Percent Clickbait") +
  ggtitle("Prevalence of Clickbait in Video Categories") +
  coord_flip()

# compare categories within each country
# fill = country is breaking
ggplot(clickbait_cats, aes(x = category_title, y = 100*p_clickbait)) +
  geom_col(color = "black") +
  facet_wrap(~country) +
  xlab("Category") +
  ylab("Percent Clickbait") +
  ggtitle("Prevalence of Clickbait in Video Categories",
          "among 5 Different Countries") +
  coord_flip()
```

Movies, how-to & style, gaming, and travel & events tend to be clickbait the most frequently. A typical frequency of clickbait
for a video category would be around 20-40%, with categories trailers, nonprofits/activism, and shows having 
clickbait the least frequently (less than 3% of videos in those categories are clickbait.)

In most video categories, France and Mexico have clickbait videos more frequently. The 
margin for this differs across categories, and it varies across categories whether France
or Mexico has a higher clickbait frequency. In some categories, Canada has a higher frequency
of clickbait as well.


### Trending Channels and Categories

### 8

> Do the same channels trend in each country? 

- Filter each data set to include only channel titles and views.
- Determine the top 10 channels that trend in each country by summing up the views and arranging them by number of views. 

```{r question-8, warning=FALSE}
channel_trend = function(data){
  df = data %>%
  select(channel_title, views) %>%
  drop_na() %>%
  group_by(channel_title) %>%
  summarize(views = sum(views)) %>%
  arrange(desc(views)) %>%
  top_n(n=10) %>%
  print()
}

## Canada
channel_trend(ca_data)
## France
channel_trend(fr_data)
## Great Britain
channel_trend(gb_data)
## India
channel_trend(in_data)
## Japan
channel_trend(jp_data)
## Mexico
channel_trend(mx_data)
## Russia
channel_trend(ru_data)
## USA
channel_trend(us_data)
```

There are no channels that trend in the top 10 of every country.  There are a couple channels that trend in more than one country.  Marvel Entertainment trends in 7 of the countries, making it the most popular amongst all 8 countries. The next most popular channel is ibighit, trending in 6 countries. Dude Perfect trends in 5, and PewDiePie, Sony Pictures Entertainment, and ChildishGambinoVEVO all trend in 4. 

```{r trending-channels-plot}
channel_trend2 = function(data){
    df = data %>%
  select(channel_title, views) %>%
      rename(Channel_Title = channel_title,
             Views = views) %>%
  drop_na() %>%
  group_by(Channel_Title) %>%
  summarize(Views = sum(Views)) %>%
      top_n(n=10)
}

bind_channel_trend2 = function(){
  US_channel = channel_trend2(us_data) %>%
    mutate(country = "US")
  FR_channel = channel_trend2(fr_data) %>%
    mutate(country = "FR")
  GB_channel = channel_trend2(gb_data) %>%
    mutate(country = "GB")
  MX_channel = channel_trend2(mx_data) %>%
    mutate(country = "MX")
  RU_channel = channel_trend(ru_data) %>%
    mutate(country = "RU")
  CA_channel = channel_trend2(ca_data) %>%
    mutate(country = "CA")
  IN_channel = channel_trend2(in_data) %>%
    mutate(country = "IN")
  JP_channel = channel_trend2(jp_data) %>%
    mutate(country = "JP")

  channel_trend2 = bind_rows(US_channel, FR_channel, GB_channel, MX_channel, 
                             CA_channel, IN_channel, JP_channel, RU_channel)
  
  return(channel_trend2)
}

channel_trend2 = bind_channel_trend2()

channel_trend3 = channel_trend2 %>%
  filter(Channel_Title == 'Marvel Entertainment' | 
           (Channel_Title == 'PewDiePie') | 
           (Channel_Title == 'Dude Perfect') | 
           (Channel_Title == 'ibighit') | 
           (Channel_Title == 'Sony Pictures Entertainment') | 
           (Channel_Title == 'ChildishGambinoVEVO'))

# plot comparing popular channels among the 8 countries 
ggplot(channel_trend3, aes(x = country, y = Views)) +
  geom_col(fill = "red", color = "black") +
  facet_wrap(~Channel_Title) +
  xlab("Country") +
  ylab("Number of Views") +
  ggtitle("Popularity of Trending Channels Between Countries")
```

As noted before, there are no channels that trend in all 8 countries.  As visualized in this graph, Marvel Entertainment trends in most of the countries.  ChildishGambinoVEVO trends in the smallest number of countries, but has the most views from a single country (Great Britain).  Overall, the channels that trend in 4 or more countries do not have a relatively large total number of views, with the exception of Marvel Entertainment.  There does not look to be any pattern between the popularity of trending channels among the different countries. 

### 9

> Do the same categories trend in each country? 

- Same steps at question 8, but with categories instead of channels. 

```{r question-9, warning=FALSE}
category_trend = function(data){
  df = data %>%
  select(category_title, views) %>%
  drop_na() %>%
  group_by(category_title) %>%
  summarize(views = sum(views)) %>%
  arrange(desc(views)) %>%
  top_n(n=10) %>%
    print()
}

## Canada
category_trend(ca_data)
## France
category_trend(fr_data)
## Great Britain
category_trend(gb_data)
## India
category_trend(in_data)
## Japan
category_trend(jp_data)
## Mexico
category_trend(mx_data)
## Russia
category_trend(ru_data)
## USA
category_trend(us_data)

```

The same categories trend in almost every country.  Music and Entertainment are the top two most popular categories in every single country we have data for.  Other categories that trend in the top 10 of all 8 countries, in no particular order, include Comedy, Film & Animation, Howto & Style, News & Politics, People & Blogs, Science & Technology, and Sports. This means that 9 out of the top 10 trending categories for each country also trend in the other countries. 

```{r trending-categories-plot, include=FALSE}
category_trend2 = function(data){
  df = data %>%
  select(category_title, views) %>%
    rename(Category = category_title,
             Views = views) %>%
  drop_na() %>%
  group_by(Category) %>%
  summarize(Views = sum(Views)) %>%
  top_n(n=10)
}

bind_category_trend2 = function(){
  US_category = category_trend2(us_data) %>%
    mutate(country = "US")
  FR_category = category_trend2(fr_data) %>%
    mutate(country = "FR")
  GB_category = category_trend2(gb_data) %>%
    mutate(country = "GB")
  MX_category = category_trend2(mx_data) %>%
    mutate(country = "MX")
  RU_category = category_trend(ru_data) %>%
    mutate(country = "RU")
  CA_category = category_trend2(ca_data) %>%
    mutate(country = "CA")
  IN_category = category_trend2(in_data) %>%
    mutate(country = "IN")
  JP_category = category_trend2(jp_data) %>%
    mutate(country = "JP")

  category_trend2 = bind_rows(US_category, FR_category, GB_category, MX_category, 
                             CA_category, IN_category, JP_category, RU_category)
  
  return(category_trend2)
}

category_trend2 = bind_category_trend2()
category_trend2

category_trend3 = category_trend2 %>%
  filter(Category == 'Music' |
          (Category == 'Entertainment') | 
           (Category == 'Comedy') | 
           (Category == 'Film & Animation') | 
           (Category == 'Howto & Style') | 
           (Category == 'People & Blogs') | 
           (Category == 'Science & Technology') |
           (Category == 'Sports'))
         


```

```{r kelli-plot}
# plot comparing popular categories among the 8 countries 
ggplot(category_trend3, aes(x = country, y = Views)) +
  geom_col(fill = "red", color = "black") +
  facet_wrap(~Category) +
  xlab("Country") +
  ylab("Number of Views") +
  ggtitle("Popularity of Trending Categories Between Countries")
```
We can see the visual that Music and Entertainment have the most views among all 8 countries.  The rest of the categories, while trending in all countries, have overall much fewer views.

## Generalizations

Similarities across countries: 

- categories with the most likes, comments, and views

- music videos tend to be popular

- clickbait tends to get more likes/view (but not necessarily more dislikes/view)

- many categories trend across multiple countries


Differences across Countries:

- frequency of clickbait varies

- still some variation in the most popular channels across countries



